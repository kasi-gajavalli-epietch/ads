"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["two-factor-setup"],{33439:(t,e,o)=>{o.d(e,{X:()=>SinglePageWizardStepContentBase});let SinglePageWizardStepContentBase=class SinglePageWizardStepContentBase extends HTMLElement{connectedCallback(){this.setAttribute("data-target","single-page-wizard-step.stepContent")}validateStep(t,e){this.autoProceedInProgress||(e&&t&&(this.autoProceedInProgress=!0),this.dispatchEvent(new CustomEvent("single-page-wizard-step-validate",{bubbles:!0,detail:{isValid:t,autoProceed:e}})))}setError(t){this.autoProceedInProgress=!1,this.dispatchEvent(new CustomEvent("single-page-wizard-step-error",{bubbles:!0,detail:{errorMessage:t}}))}clearError(){this.dispatchEvent(new CustomEvent("single-page-wizard-step-error",{bubbles:!0}))}async onStepRendered(){}setStepState(t){}async onNextClick(){return{proceed:!0}}async onPreviousClick(){return{proceed:!0}}isStepValid(){return!0}constructor(...t){super(...t),this.autoProceedInProgress=!1}}},43334:(t,e,o)=>{var s,r,i,n=o(76006),a=o(33439),d=o(3447);function p(t,e){if(e.has(t))throw TypeError("Cannot initialize the same private elements twice on an object")}function c(t,e){return e.get?e.get.call(t):e.value}function h(t,e,o){if(e.set)e.set.call(t,o);else{if(!e.writable)throw TypeError("attempted to set read only private field");e.value=o}}function l(t,e,o){if(!e.has(t))throw TypeError("attempted to "+o+" private field on non-instance");return e.get(t)}function u(t,e){var o=l(t,e,"get");return c(t,o)}function f(t,e,o){p(t,e),e.set(t,o)}function m(t,e,o){var s=l(t,e,"set");return h(t,s,o),o}var v=function(t,e,o,s){var r,i=arguments.length,n=i<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,o):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,o,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(n=(i<3?r(n):i>3?r(e,o,n):r(e,o))||n);return i>3&&n&&Object.defineProperty(e,o,n),n};let y=(s=new WeakMap,class TwoFactorSetupVerificationElement extends a.X{connectedCallback(){this.setAttribute("data-target","single-page-wizard-step.stepContent"),this.initiateTwoFactorSetup("app");let{signal:t}=m(this,s,new AbortController);this.addEventListener("switch-selection",this.initiateTwoFactorSwitch,{signal:t})}disconnectedCallback(){u(this,s)?.abort()}async setStepState(t){if(this.wizardState=t,!this.loaded)return;this.isAppMode()?(this.handleAppModeWarning(),this.renderQRCodeImg(this.wizardState.qr_code_img_data),this.appOtpInput.value=this.wizardState.dev_otp||"",this.mashedSecret.textContent=this.wizardState.mashed_secret,this.smsElem.hidden=!0,this.appElem.hidden=!1):(this.appElem.hidden=!0,this.smsElem.hidden=!1),this.rendered&&await this.focus();let e=document.getElementById("two-factor-switch-selection");null!=e&&e.dispatchEvent(new CustomEvent("init-done",{detail:this.wizardState.type}))}async onStepRendered(){this.rendered=!0,this.focus()}async focus(){this.isAppMode()?this.appOtpInput.focus():this.smsPhoneInput.focus()}renderQRCodeImg(t){this.qrCodeImg.src=t,this.spinner.setAttribute("style","display: none"),this.qrCodeImg.hidden=!1}isAppMode(){return"app"===this.wizardState.type}handleAppModeWarning(){this.rendered&&this.showAppWarning?(this.appScanTextA.hidden=!0,this.appScanTextB.hidden=!1):this.showAppWarning=!0}async onNextClick(){this.clearError();let t=this.isAppMode()?this.appForm:this.smsForm,e=t.querySelector(".js-data-url-csrf"),o=new FormData,s=this.isAppMode()?this.appOtpInput.value:this.smsOtpInput.value;o.append("type",this.wizardState.type),o.append("otp",s.trim());try{let s=await fetch(t.action,{mode:"same-origin",method:"POST",body:o,headers:{Accept:"application/json","Scoped-CSRF-Token":e.value,"X-Requested-With":"XMLHttpRequest"}});if(!s.ok){if(429===s.status)return this.setError("Too many incorrect OTP attempts. Please try again later."),{proceed:!1};let t=await s.json();return t.error?this.setError(t.error):this.setError("Two-factor code verification failed. Please try again."),{proceed:!1}}}catch(t){return this.setError("Two-factor code verification failed. Please try again."),{proceed:!1}}let r=document.getElementById("two-factor-switch-selection");return null!=r&&r.dispatchEvent(new CustomEvent("verify-done")),{wizardState:this.wizardState,proceed:!0}}otpChange(){this.validateStep(this.isStepValid(),!0)}formSubmit(t){t.preventDefault(),this.otpChange()}smsPhoneInputChange(){this.buttonSendSms.disabled=0===this.smsPhoneInput.value.trim().length}setSmsControlState(t,e,o){this.buttonSendSms.disabled=t||e;let s=!t&&!e,r=s&&!!o;r&&(this.smsError.textContent=o),this.smsSendStatusError.hidden=!s,this.smsSendStatusSuccess.hidden=t||!e,this.smsSendStatusInProgress.hidden=!t,this.smsDefaultError.hidden=!(s&&!o),this.smsError.hidden=!r,this.smsOtpInput.disabled=t||s,e&&(this.smsCodeForm.hidden=!1,this.smsOtpInput.focus())}async buttonSendSmsClick(){this.setSmsControlState(!0,!1),this.smsOtpInput.value="",this.smsOtpInput.disabled=!0,this.validateStep(!1);let t=this.buttonSendSms.getAttribute("data-url"),e=this.smsForm.querySelector(".js-data-url-csrf-send"),o=`${this.countryCodeSelect.value} ${this.smsPhoneInput.value}`,s=new FormData;s.append("number",o);let r=this.smsForm.querySelector(".js-octocaptcha-token");r&&r.value&&s.append("octocaptcha-token",r.value);let i=await fetch(t,{mode:"same-origin",method:"POST",body:s,headers:{Accept:"application/json","Scoped-CSRF-Token":e.value,"X-Requested-With":"XMLHttpRequest"}});if(!i.ok){let t=await i.json();this.setSmsControlState(!1,!1,t.error);return}if(this.smsPhoneInput.disabled=!0,this.setSmsControlState(!1,!0),this.wizardState.dev_otp){this.smsOtpInput.value=this.wizardState.dev_otp,this.smsOtpInput.disabled=!1,this.validateStep(this.isStepValid(),!1);return}}isStepValid(){let t=this.isAppMode()?this.appOtpInput:this.smsOtpInput;return RegExp("^([0-9]{6})$").test(t.value)}updateHeaders(t){let e=document.getElementById("wizard-step-factor"),o=e.getElementsByClassName("wizard-step-title"),s=o[0],r=o[1];switch(t){case"sms":s.textContent=r.textContent="Setup SMS authentication";break;case"app":s.textContent=r.textContent="Setup authenticator app"}}async initiateTwoFactorSwitch(t){let e=t.detail;await this.initiateTwoFactorSetup(e)}async initiateTwoFactorSetup(t){let e=this.switchForm.querySelector(".js-data-url-csrf"),o=new FormData;o.append("type",t);let s=await fetch(this.switchForm.action,{mode:"same-origin",method:"POST",body:o,headers:{Accept:"application/json","Scoped-CSRF-Token":e.value,"X-Requested-With":"XMLHttpRequest"}});if(!s.ok)return this.setError(this.errorMessage),{proceed:!1};this.rendered&&this.updateHeaders(t);let r=await s.json(),i={...this.wizardState,type:t,formatted_recovery_codes:r.formatted_recovery_codes,mashed_secret:r.mashed_secret,qr_code_img_data:r.qr_code_img_data||"",dev_otp:r.dev_otp};this.loaded=!0,this.setStepState(i)}constructor(...t){super(...t),this.loaded=!1,this.rendered=!1,this.showAppWarning=!1,f(this,s,{writable:!0,value:null})}});v([n.fA],y.prototype,"appForm",void 0),v([n.fA],y.prototype,"smsForm",void 0),v([n.fA],y.prototype,"smsElem",void 0),v([n.fA],y.prototype,"appElem",void 0),v([n.fA],y.prototype,"countryCodeSelect",void 0),v([n.fA],y.prototype,"smsPhoneInput",void 0),v([n.fA],y.prototype,"appOtpInput",void 0),v([n.fA],y.prototype,"smsOtpInput",void 0),v([n.fA],y.prototype,"qrCodeImg",void 0),v([n.fA],y.prototype,"mashedSecret",void 0),v([n.fA],y.prototype,"smsDefaultError",void 0),v([n.fA],y.prototype,"smsError",void 0),v([n.fA],y.prototype,"buttonSendSms",void 0),v([n.fA],y.prototype,"smsSendStatusError",void 0),v([n.fA],y.prototype,"smsSendStatusInProgress",void 0),v([n.fA],y.prototype,"smsSendStatusSuccess",void 0),v([n.fA],y.prototype,"smsCodeForm",void 0),v([n.fA],y.prototype,"switchForm",void 0),v([n.fA],y.prototype,"appScanTextA",void 0),v([n.fA],y.prototype,"appScanTextB",void 0),v([n.fA],y.prototype,"spinner",void 0),v([n.Lj],y.prototype,"errorMessage",void 0),v([(0,d.D)(50)],y.prototype,"otpChange",null),y=v([n.Ih],y);var S=function(t,e,o,s){var r,i=arguments.length,n=i<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,o):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,o,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(n=(i<3?r(n):i>3?r(e,o,n):r(e,o))||n);return i>3&&n&&Object.defineProperty(e,o,n),n};let w=class TwoFactorSetupRecoveryCodesElement extends a.X{async setStepState(t){if(this.wizardState=t,this.codes.textContent="",this.wizardState.formatted_recovery_codes)for(let t of this.wizardState.formatted_recovery_codes){let e=document.createElement("li");e.textContent=t,e.className="two-factor-recovery-code",this.codes.appendChild(e)}}async onNextClick(){let t=this.form.querySelector(".js-data-url-csrf"),e=new FormData;e.append("type",this.wizardState.type),this.clearError();let o=await fetch(this.form.action,{mode:"same-origin",method:"POST",body:e,headers:{Accept:"application/json","Scoped-CSRF-Token":t.value,"X-Requested-With":"XMLHttpRequest"}});if(!o.ok)return this.setError(this.errorMessage),{proceed:!1};let s=document.getElementById("two-factor-reconfigure-notification");if(s){let t=s.querySelector(".js-flash-close");t&&t.click()}return{proceed:!0}}async onDownloadClick(){let t=document.createElement("div");return t.id="one-off-ignore-single-page-wizard-warning",document.body.appendChild(t),this.downloadCodesForm.submit(),this.validateStep(!0),{proceed:!0}}isStepValid(){return!1}};function g(t,e){if(e.has(t))throw TypeError("Cannot initialize the same private elements twice on an object")}function b(t,e){return e.get?e.get.call(t):e.value}function E(t,e,o){if(e.set)e.set.call(t,o);else{if(!e.writable)throw TypeError("attempted to set read only private field");e.value=o}}function A(t,e,o){if(!e.has(t))throw TypeError("attempted to "+o+" private field on non-instance");return e.get(t)}function C(t,e){var o=A(t,e,"get");return b(t,o)}function I(t,e,o){g(t,e),e.set(t,o)}function O(t,e,o){var s=A(t,e,"set");return E(t,s,o),o}S([n.Lj],w.prototype,"errorMessage",void 0),S([n.fA],w.prototype,"codes",void 0),S([n.fA],w.prototype,"form",void 0),S([n.fA],w.prototype,"downloadCodesForm",void 0),w=S([n.Ih],w);var T=function(t,e,o,s){var r,i=arguments.length,n=i<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,o):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,o,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(n=(i<3?r(n):i>3?r(e,o,n):r(e,o))||n);return i>3&&n&&Object.defineProperty(e,o,n),n};let P=(r=new WeakMap,class TwoFactorSetupSwitchSelectionElement extends HTMLElement{connectedCallback(){let{signal:t}=O(this,r,new AbortController);this.addEventListener("verify-done",this.hide,{signal:t}),this.addEventListener("init-done",this.show,{signal:t})}disconnectedCallback(){C(this,r)?.abort()}hide(){this.box.hidden=!0}show(t){let e=t.detail;this.box.hidden=!1,"sms"===e?(this.smsElem.hidden=!0,this.appElem.hidden=!1):(this.appElem.hidden=!0,this.smsElem.hidden=!1)}switchMethodApp(){this.switchMethodEvent("app")}switchMethodSms(){this.switchMethodEvent("sms")}switchMethodEvent(t){let e=document.getElementById("two-factor-setup-verification-step");null!=e&&e.dispatchEvent(new CustomEvent("switch-selection",{detail:t}))}constructor(...t){super(...t),I(this,r,{writable:!0,value:null})}});function F(t,e){if(e.has(t))throw TypeError("Cannot initialize the same private elements twice on an object")}function R(t,e){return e.get?e.get.call(t):e.value}function j(t,e,o){if(e.set)e.set.call(t,o);else{if(!e.writable)throw TypeError("attempted to set read only private field");e.value=o}}function k(t,e,o){if(!e.has(t))throw TypeError("attempted to "+o+" private field on non-instance");return e.get(t)}function M(t,e){var o=k(t,e,"get");return R(t,o)}function _(t,e,o){F(t,e),e.set(t,o)}function q(t,e,o){var s=k(t,e,"set");return j(t,s,o),o}T([n.fA],P.prototype,"box",void 0),T([n.fA],P.prototype,"smsElem",void 0),T([n.fA],P.prototype,"appElem",void 0),P=T([n.Ih],P);var z=function(t,e,o,s){var r,i=arguments.length,n=i<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,o):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,o,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(n=(i<3?r(n):i>3?r(e,o,n):r(e,o))||n);return i>3&&n&&Object.defineProperty(e,o,n),n};let x=(i=new WeakMap,class TwoFactorSetupAddMethodsElement extends a.X{connectedCallback(){this.setAttribute("data-target","single-page-wizard-step.stepContent");let t=document.querySelector(".js-u2f-registrations");document.querySelector("#add-two-factor-u2f-registration")?.setAttribute("hidden","true"),t.childElementCount>0&&this.showU2fEnabledLabel.removeAttribute("hidden"),q(this,i,new MutationObserver(e=>{for(let o of e)"childList"===o.type&&(o.addedNodes.length>0?this.showU2fEnabledLabel.removeAttribute("hidden"):o.removedNodes.length>0&&0===t.childElementCount&&this.showU2fEnabledLabel.setAttribute("hidden","true"))})),M(this,i).observe(t,{childList:!0}),this.showU2fRegButton.addEventListener("click",()=>{document.querySelector("#add-two-factor-u2f-registration")?.removeAttribute("hidden"),this.showU2fRegButton.setAttribute("hidden","true")})}disconnectedCallback(){M(this,i).disconnect()}async setStepState(t){let{type:e}=t;this.setBannerMessage(e)}setBannerMessage(t){let e="";switch(t){case"app":default:e="your authenticator app";break;case"sms":e="SMS"}document.querySelector(".wizard-step-banner .Banner-title").innerHTML=`You have enabled two-factor authentication using ${e}.`}constructor(...t){super(...t),_(this,i,{writable:!0,value:void 0})}});z([n.fA],x.prototype,"showU2fRegButton",void 0),z([n.fA],x.prototype,"showU2fEnabledLabel",void 0),x=z([n.Ih],x);var L=function(t,e,o,s){var r,i=arguments.length,n=i<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,o):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,o,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(n=(i<3?r(n):i>3?r(e,o,n):r(e,o))||n);return i>3&&n&&Object.defineProperty(e,o,n),n};let B=class TwoFactorConfigureOtpFactorElement extends HTMLElement{connectedCallback(){this.showSMS(),this.showButtons.hidden=!1}configuringApp(){return"app"===this.factorType}showSMS(){this.configuringApp()||(this.smsElem.hidden=!1)}smsPhoneInputChange(){this.buttonSendSms.disabled=!this.smsPhoneInput.value}setSmsControlState(t,e,o){this.buttonSendSms.disabled=t||e;let s=!t&&!e,r=s&&!!o;r&&(this.smsError.textContent=o),this.smsSendStatusError.hidden=!s,this.smsSendStatusSuccess.hidden=t||!e,this.smsSendStatusInProgress.hidden=!t,this.smsDefaultError.hidden=!(s&&!o),this.smsError.hidden=!r,this.smsOtpInput.disabled=t||s,e&&(this.smsCodeForm.hidden=!1,this.smsOtpInput.focus())}async buttonSendSmsClick(){if(this.buttonSendSms.hasAttribute("data-sudo-required"))return;this.setSmsControlState(!0,!1),this.smsOtpInput.value="",this.smsOtpInput.disabled=!0;let t=this.buttonSendSms.getAttribute("data-url"),e=this.smsForm.querySelector(".js-data-url-csrf-send"),o=`${this.countryCodeSelect.value} ${this.smsPhoneInput.value}`,s=new FormData;s.append("number",o),s.append("inline_configure","true");let r=this.smsForm.querySelector(".js-octocaptcha-token");r&&r.value&&s.append("octocaptcha-token",r.value);let i=await fetch(t,{mode:"same-origin",method:"POST",body:s,headers:{Accept:"application/json","Scoped-CSRF-Token":e.value,"X-Requested-With":"XMLHttpRequest"}});i.ok&&200===i.status?(this.smsPhoneInput.disabled=!0,this.setSmsControlState(!1,!0)):this.setSmsControlState(!1,!1,await this.responseErrorMessage(i))}async otpChange(){let t=this.configuringApp()?this.appOtpInput:this.smsOtpInput,e=RegExp("^([0-9]{6})$");if(!e.test(t.value))return;t.disabled=!0;let o=await this.verifyOtp(t.value);o.success?(this.clearError(),this.saveButton.disabled=!1,t.disabled=!0,this.otpVerifySuccess.hidden=!1):(this.setError(o.error||"Unable to verify OTP. Please try again."),t.disabled=!1,t.focus())}setError(t){this.verifyError.textContent=t,this.verifyError.hidden=!1}clearError(){this.verifyError.textContent="",this.verifyError.hidden=!0}async verifyOtp(t){let e=this.configuringApp()?this.appForm:this.smsForm,o=this.configuringApp()?"app":"sms",s=e.querySelector(".js-data-url-csrf"),r=new FormData;r.append("type",o),r.append("otp",t.trim());let i=await fetch(e.action,{mode:"same-origin",method:"POST",body:r,headers:{Accept:"application/json","Scoped-CSRF-Token":s.value,"X-Requested-With":"XMLHttpRequest"}});return 200!==i.status?{success:!1,error:await this.responseErrorMessage(i)}:{success:!0}}async responseErrorMessage(t){try{let e=await t.json();return e.error}catch(e){if(t.status>=400&&t.status<500)return"Unauthorized to complete request. Try refreshing the page or contact support.";return"Server encountered an error. Please try again."}}constructor(...t){super(...t),this.factorType="app"}};L([n.fA],B.prototype,"appOtpInput",void 0),L([n.fA],B.prototype,"appForm",void 0),L([n.fA],B.prototype,"smsInitialLoad",void 0),L([n.fA],B.prototype,"smsElem",void 0),L([n.fA],B.prototype,"smsPhoneInput",void 0),L([n.fA],B.prototype,"buttonSendSms",void 0),L([n.fA],B.prototype,"smsOtpInput",void 0),L([n.fA],B.prototype,"countryCodeSelect",void 0),L([n.fA],B.prototype,"smsForm",void 0),L([n.fA],B.prototype,"smsCodeForm",void 0),L([n.fA],B.prototype,"smsSendStatusSuccess",void 0),L([n.fA],B.prototype,"smsSendStatusInProgress",void 0),L([n.fA],B.prototype,"smsError",void 0),L([n.fA],B.prototype,"smsDefaultError",void 0),L([n.fA],B.prototype,"smsSendStatusError",void 0),L([n.fA],B.prototype,"otpVerifySuccess",void 0),L([n.fA],B.prototype,"verifyError",void 0),L([n.fA],B.prototype,"saveButton",void 0),L([n.fA],B.prototype,"showButtons",void 0),L([n.Lj],B.prototype,"factorType",void 0),L([(0,d.D)(50)],B.prototype,"otpChange",null),B=L([n.Ih],B)}},t=>{var e=e=>t(t.s=e);t.O(0,["vendors-node_modules_github_mini-throttle_dist_decorators_js-node_modules_github_catalyst_lib-ce537e"],()=>e(43334));var o=t.O()}]);
//# sourceMappingURL=two-factor-setup-9ab69b47be9c.js.map